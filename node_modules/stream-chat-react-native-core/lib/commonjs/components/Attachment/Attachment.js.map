{"version":3,"sources":["Attachment.tsx"],"names":["AttachmentWithContext","props","attachment","AttachmentActions","Card","FileAttachment","Gallery","Giphy","giphyVersion","UrlPreview","hasAttachmentActions","actions","length","type","title_link","og_scrape_url","image_url","thumb_url","id","areEqual","prevProps","nextProps","prevAttachment","isAttachmentEqual","nextAttachment","attachmentEqual","MemoizedAttachment","React","memo","Attachment","PropAttachmentActions","PropCard","PropFileAttachment","PropGallery","PropGiphy","PropGiphyVersion","PropUrlPreview","ContextAttachmentActions","ContextCard","ContextFileAttachment","ContextGallery","ContextGiphy","ContextGiphyVersion","ContextUrlPreview","AttachmentActionsDefault","CardDefault","FileAttachmentDefault","GalleryDefault","GiphyDefault"],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport type { Attachment as AttachmentType } from 'stream-chat';\n\nimport { AttachmentActions as AttachmentActionsDefault } from '../../components/Attachment/AttachmentActions';\nimport { Card as CardDefault } from '../../components/Attachment/Card';\nimport { FileAttachment as FileAttachmentDefault } from '../../components/Attachment/FileAttachment';\nimport { Gallery as GalleryDefault } from '../../components/Attachment/Gallery';\nimport { Giphy as GiphyDefault } from '../../components/Attachment/Giphy';\nimport {\n  MessagesContextValue,\n  useMessagesContext,\n} from '../../contexts/messagesContext/MessagesContext';\nimport { isVideoPackageAvailable } from '../../native';\n\nimport type { DefaultStreamChatGenerics } from '../../types/types';\n\nexport type ActionHandler = (name: string, value: string) => void;\n\nexport type AttachmentPropsWithContext<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Pick<\n  MessagesContextValue<StreamChatGenerics>,\n  | 'AttachmentActions'\n  | 'Card'\n  | 'FileAttachment'\n  | 'Gallery'\n  | 'giphyVersion'\n  | 'Giphy'\n  | 'isAttachmentEqual'\n  | 'UrlPreview'\n> & {\n  /**\n   * The attachment to render\n   */\n  attachment: AttachmentType<StreamChatGenerics>;\n};\n\nconst AttachmentWithContext = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: AttachmentPropsWithContext<StreamChatGenerics>,\n) => {\n  const {\n    attachment,\n    AttachmentActions,\n    Card,\n    FileAttachment,\n    Gallery,\n    Giphy,\n    giphyVersion,\n    UrlPreview,\n  } = props;\n\n  const hasAttachmentActions = !!attachment.actions?.length;\n\n  if (attachment.type === 'giphy' || attachment.type === 'imgur') {\n    return <Giphy attachment={attachment} giphyVersion={giphyVersion} />;\n  }\n\n  if (\n    (attachment.title_link || attachment.og_scrape_url) &&\n    (attachment.image_url || attachment.thumb_url)\n  ) {\n    return <UrlPreview {...attachment} />;\n  }\n\n  if (attachment.type === 'image') {\n    return (\n      <>\n        <Gallery images={[attachment]} />\n        {hasAttachmentActions && (\n          <AttachmentActions key={`key-actions-${attachment.id}`} {...attachment} />\n        )}\n      </>\n    );\n  }\n\n  if (attachment.type === 'video' && !attachment.og_scrape_url) {\n    return isVideoPackageAvailable() ? (\n      <>\n        <Gallery videos={[attachment]} />\n        {hasAttachmentActions && (\n          <AttachmentActions key={`key-actions-${attachment.id}`} {...attachment} />\n        )}\n      </>\n    ) : (\n      <FileAttachment attachment={attachment} />\n    );\n  }\n\n  if (attachment.type === 'file' || attachment.type === 'audio') {\n    return <FileAttachment attachment={attachment} />;\n  }\n\n  if (hasAttachmentActions) {\n    return (\n      <>\n        <Card {...attachment} />\n        <AttachmentActions key={`key-actions-${attachment.id}`} {...attachment} />\n      </>\n    );\n  } else {\n    return <Card {...attachment} />;\n  }\n};\n\nconst areEqual = <StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics>(\n  prevProps: AttachmentPropsWithContext<StreamChatGenerics>,\n  nextProps: AttachmentPropsWithContext<StreamChatGenerics>,\n) => {\n  const { attachment: prevAttachment, isAttachmentEqual } = prevProps;\n  const { attachment: nextAttachment } = nextProps;\n\n  const attachmentEqual =\n    prevAttachment.actions?.length === nextAttachment.actions?.length &&\n    prevAttachment.image_url === nextAttachment.image_url &&\n    prevAttachment.thumb_url === nextAttachment.thumb_url;\n  if (!attachmentEqual) return false;\n\n  if (isAttachmentEqual) {\n    return isAttachmentEqual(prevAttachment, nextAttachment);\n  }\n\n  return true;\n};\n\nconst MemoizedAttachment = React.memo(\n  AttachmentWithContext,\n  areEqual,\n) as typeof AttachmentWithContext;\n\nexport type AttachmentProps<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Partial<\n  Pick<\n    MessagesContextValue<StreamChatGenerics>,\n    | 'AttachmentActions'\n    | 'Card'\n    | 'FileAttachment'\n    | 'Gallery'\n    | 'Giphy'\n    | 'giphyVersion'\n    | 'UrlPreview'\n    | 'isAttachmentEqual'\n  >\n> &\n  Pick<AttachmentPropsWithContext<StreamChatGenerics>, 'attachment'>;\n\n/**\n * Attachment - The message attachment\n */\nexport const Attachment = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: AttachmentProps<StreamChatGenerics>,\n) => {\n  const {\n    attachment,\n    AttachmentActions: PropAttachmentActions,\n    Card: PropCard,\n    FileAttachment: PropFileAttachment,\n    Gallery: PropGallery,\n    Giphy: PropGiphy,\n    giphyVersion: PropGiphyVersion,\n    UrlPreview: PropUrlPreview,\n  } = props;\n\n  const {\n    AttachmentActions: ContextAttachmentActions,\n    Card: ContextCard,\n    FileAttachment: ContextFileAttachment,\n    Gallery: ContextGallery,\n    Giphy: ContextGiphy,\n    giphyVersion: ContextGiphyVersion,\n    isAttachmentEqual,\n    UrlPreview: ContextUrlPreview,\n  } = useMessagesContext<StreamChatGenerics>();\n\n  if (!attachment) {\n    return null;\n  }\n\n  const AttachmentActions =\n    PropAttachmentActions || ContextAttachmentActions || AttachmentActionsDefault;\n  const Card = PropCard || ContextCard || CardDefault;\n  const FileAttachment = PropFileAttachment || ContextFileAttachment || FileAttachmentDefault;\n  const Gallery = PropGallery || ContextGallery || GalleryDefault;\n  const Giphy = PropGiphy || ContextGiphy || GiphyDefault;\n  const UrlPreview = PropUrlPreview || ContextUrlPreview || CardDefault;\n  const giphyVersion = PropGiphyVersion || ContextGiphyVersion;\n\n  return (\n    <MemoizedAttachment\n      {...{\n        attachment,\n        AttachmentActions,\n        Card,\n        FileAttachment,\n        Gallery,\n        Giphy,\n        giphyVersion,\n        isAttachmentEqual,\n        UrlPreview,\n      }}\n    />\n  );\n};\n"]}