{"version":3,"sources":["Gallery.tsx"],"names":["GalleryImage","props","uri","rest","MemoizedGalleryImage","React","memo","prevProps","nextProps","styles","StyleSheet","create","flex","galleryContainer","borderTopLeftRadius","borderTopRightRadius","flexDirection","flexWrap","overflow","imageContainer","display","justifyContent","padding","moreImagesContainer","alignItems","margin","moreImagesText","color","fontSize","fontWeight","GalleryWithContext","additionalTouchableProps","alignment","groupStyles","hasThreadReplies","images","legacyImageViewerSwipeBehaviour","message","onLongPress","onPress","onPressIn","preventPress","setImage","setImages","setOverlay","threadList","videos","VideoThumbnail","theme","overlay","colors","messageSimple","gallery","galleryItemColumn","gridHeight","gridWidth","image","maxHeight","maxWidth","minHeight","minWidth","sizeConfig","imagesAndVideos","length","height","invertedDirections","thumbnailGrid","width","messageText","text","messageId","id","numOfColumns","map","rows","colIndex","numOfRows","rowIndex","resizeMode","type","url","openImageViewer","defaultOnPress","borderRadius","event","emitter","defaultHandler","absoluteFillObject","backgroundColor","areEqual","prevGroupStyles","prevHasThreadReplies","prevImages","prevMessage","prevVideos","nextGroupStyles","nextHasThreadReplies","nextImages","nextMessage","nextVideos","messageEqual","groupStylesEqual","hasThreadRepliesEqual","imagesEqual","every","index","image_url","thumb_url","videosEqual","MemoizedGallery","Gallery","propAdditionalTouchableProps","propAlignment","propGroupStyles","propImages","propOnLongPress","propOnPress","propOnPressIn","propPreventPress","propSetImage","propSetOverlay","propThreadList","propVideos","PropVideoThumbnail","contextSetImage","contextAlignment","contextGroupStyles","contextImages","contextOnLongPress","contextOnPress","contextOnPressIn","contextPreventPress","contextThreadList","contextVideos","contextAdditionalTouchableProps","ContextVideoThumnbnail","contextSetOverlay","channelId","cid","reply_count","displayName"],"mappings":";;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AAEA;;AAEA;;AAGA;;AAIA;;AAIA;;AAIA;;AAIA;;AACA;;AAEA;;;;;;;;;;;AAEA,IAAMA,YAIL,GAAG,SAJEA,YAIF,CAACC,KAAD,EAAW;AACb,MAAQC,GAAR,GAAyBD,KAAzB,CAAQC,GAAR;AAAA,MAAgBC,IAAhB,6CAAyBF,KAAzB;AAEA,SACE,gCAAC,kBAAD,gCACME,IADN;AAEE,IAAA,MAAM,EAAE;AACND,MAAAA,GAAG,EAAE,mCAAuBA,GAAvB;AADC,KAFV;AAKE,IAAA,MAAM,EAAC,yBALT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF;AASD,CAhBD;;AAkBA,IAAME,oBAAoB,GAAGC,kBAAMC,IAAN,CAC3BN,YAD2B,EAE3B,UAACO,SAAD,EAAYC,SAAZ;AAAA,SACE,gCAAoBD,SAAS,CAACL,GAA9B,MAAuC,gCAAoBM,SAAS,CAACN,GAA9B,CADzC;AAAA,CAF2B,CAA7B;;AAMA,IAAMO,MAAM,GAAGC,wBAAWC,MAAX,CAAkB;AAC/BC,EAAAA,IAAI,EAAE;AAAEA,IAAAA,IAAI,EAAE;AAAR,GADyB;AAE/BC,EAAAA,gBAAgB,EAAE;AAChBC,IAAAA,mBAAmB,EAAE,EADL;AAEhBC,IAAAA,oBAAoB,EAAE,EAFN;AAGhBC,IAAAA,aAAa,EAAE,KAHC;AAIhBC,IAAAA,QAAQ,EAAE,MAJM;AAKhBC,IAAAA,QAAQ,EAAE;AALM,GAFa;AAS/BC,EAAAA,cAAc,EAAE;AAAEC,IAAAA,OAAO,EAAE,MAAX;AAAmBJ,IAAAA,aAAa,EAAE,KAAlC;AAAyCK,IAAAA,cAAc,EAAE,QAAzD;AAAmEC,IAAAA,OAAO,EAAE;AAA5E,GATe;AAU/BC,EAAAA,mBAAmB,EAAE;AACnBC,IAAAA,UAAU,EAAE,QADO;AAEnBH,IAAAA,cAAc,EAAE,QAFG;AAGnBI,IAAAA,MAAM,EAAE;AAHW,GAVU;AAe/BC,EAAAA,cAAc,EAAE;AAAEC,IAAAA,KAAK,EAAE,SAAT;AAAoBC,IAAAA,QAAQ,EAAE,EAA9B;AAAkCC,IAAAA,UAAU,EAAE;AAA9C;AAfe,CAAlB,CAAf;;AAuDA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAGzB7B,KAHyB,EAItB;AACH,MACE8B,wBADF,GAkBI9B,KAlBJ,CACE8B,wBADF;AAAA,MAEEC,SAFF,GAkBI/B,KAlBJ,CAEE+B,SAFF;AAAA,MAGEC,WAHF,GAkBIhC,KAlBJ,CAGEgC,WAHF;AAAA,MAIEC,gBAJF,GAkBIjC,KAlBJ,CAIEiC,gBAJF;AAAA,MAKEC,MALF,GAkBIlC,KAlBJ,CAKEkC,MALF;AAAA,MAMEC,+BANF,GAkBInC,KAlBJ,CAMEmC,+BANF;AAAA,MAOEC,OAPF,GAkBIpC,KAlBJ,CAOEoC,OAPF;AAAA,MAQEC,YARF,GAkBIrC,KAlBJ,CAQEqC,WARF;AAAA,MASEC,QATF,GAkBItC,KAlBJ,CASEsC,OATF;AAAA,MAUEC,UAVF,GAkBIvC,KAlBJ,CAUEuC,SAVF;AAAA,MAWEC,YAXF,GAkBIxC,KAlBJ,CAWEwC,YAXF;AAAA,MAYEC,QAZF,GAkBIzC,KAlBJ,CAYEyC,QAZF;AAAA,MAaEC,SAbF,GAkBI1C,KAlBJ,CAaE0C,SAbF;AAAA,MAcEC,UAdF,GAkBI3C,KAlBJ,CAcE2C,UAdF;AAAA,MAeEC,UAfF,GAkBI5C,KAlBJ,CAeE4C,UAfF;AAAA,MAgBEC,MAhBF,GAkBI7C,KAlBJ,CAgBE6C,MAhBF;AAAA,MAiBEC,cAjBF,GAkBI9C,KAlBJ,CAiBE8C,cAjBF;;AAoBA,kBAoBI,6BApBJ;AAAA,kCACEC,KADF;AAAA,MAEcC,OAFd,mBAEIC,MAFJ,CAEcD,OAFd;AAAA,8CAGIE,aAHJ,CAIMC,OAJN;AAAA,MAKQvC,gBALR,yBAKQA,gBALR;AAAA,MAMQwC,iBANR,yBAMQA,iBANR;AAAA,MAOQC,UAPR,yBAOQA,UAPR;AAAA,MAQQC,SARR,yBAQQA,SARR;AAAA,MASQC,KATR,yBASQA,KATR;AAAA,MAUQrC,cAVR,yBAUQA,cAVR;AAAA,MAWQsC,SAXR,yBAWQA,SAXR;AAAA,MAYQC,QAZR,yBAYQA,QAZR;AAAA,MAaQC,SAbR,yBAaQA,SAbR;AAAA,MAcQC,QAdR,yBAcQA,QAdR;AAAA,MAeQrC,mBAfR,yBAeQA,mBAfR;AAAA,MAgBQG,cAhBR,yBAgBQA,cAhBR;;AAsBA,MAAMmC,UAAU,GAAG;AACjBP,IAAAA,UAAU,EAAVA,UADiB;AAEjBC,IAAAA,SAAS,EAATA,SAFiB;AAGjBE,IAAAA,SAAS,EAATA,SAHiB;AAIjBC,IAAAA,QAAQ,EAARA,QAJiB;AAKjBC,IAAAA,SAAS,EAATA,SALiB;AAMjBC,IAAAA,QAAQ,EAARA;AANiB,GAAnB;AASA,MAAME,eAAe,iDAAQ3B,MAAM,IAAI,EAAlB,uCAA2BW,MAAM,IAAI,EAArC,EAArB;;AACA,iBAA6D,oBAC3D;AAAA,WACE,gCAAa;AACXX,MAAAA,MAAM,EAAE2B,eADG;AAEXD,MAAAA,UAAU,EAAVA;AAFW,KAAb,CADF;AAAA,GAD2D,EAM3D,CAACC,eAAe,CAACC,MAAjB,CAN2D,CAA7D;AAAA,MAAQC,MAAR,YAAQA,MAAR;AAAA,MAAgBC,kBAAhB,YAAgBA,kBAAhB;AAAA,MAAoCC,aAApC,YAAoCA,aAApC;AAAA,MAAmDC,KAAnD,YAAmDA,KAAnD;;AASA,MAAI,EAACL,eAAD,YAACA,eAAe,CAAEC,MAAlB,CAAJ,EAA8B,OAAO,IAAP;AAC9B,MAAMK,WAAW,GAAG/B,OAAH,oBAAGA,OAAO,CAAEgC,IAA7B;AACA,MAAMC,SAAS,GAAGjC,OAAH,oBAAGA,OAAO,CAAEkC,EAA3B;AACA,MAAMC,YAAY,GAAGN,aAAa,CAACH,MAAnC;AAEA,SACE,gCAAC,iBAAD;AACE,IAAA,KAAK,EAAE,CACLtD,MAAM,CAACI,gBADF,EAEL;AACEmD,MAAAA,MAAM,EAANA,MADF;AAEEG,MAAAA,KAAK,EAALA;AAFF,KAFK,EAMLtD,gBANK,EAOL;AACEG,MAAAA,aAAa,EAAEiD,kBAAkB,GAAG,QAAH,GAAc;AADjD,KAPK,CADT;AAYE,IAAA,MAAM,EAAC,mBAZT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAcGC,aAAa,CAACO,GAAd,CAAkB,UAACC,IAAD,EAAOC,QAAP,EAAoB;AACrC,QAAMC,SAAS,GAAGF,IAAI,CAACX,MAAvB;AACA,WACE,gCAAC,iBAAD;AACE,MAAA,GAAG,gBAAaE,kBAAkB,GAAG,KAAH,GAAW,QAA1C,UAAsDU,QAD3D;AAEE,MAAA,KAAK,EAAE,CACL;AACE3D,QAAAA,aAAa,EAAEiD,kBAAkB,GAAG,KAAH,GAAW;AAD9C,OADK,EAILZ,iBAJK,CAFT;AAQE,MAAA,MAAM,gBAAaY,kBAAkB,GAAG,KAAH,GAAW,QAA1C,UAAsDU,QAR9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAUGD,IAAI,CAACD,GAAL,CAAS,gBAA2CI,QAA3C,EAAwD;AAAA,UAArDb,MAAqD,QAArDA,MAAqD;AAAA,UAA7Cc,UAA6C,QAA7CA,UAA6C;AAAA,UAAjCC,IAAiC,QAAjCA,IAAiC;AAAA,UAA3BC,GAA2B,QAA3BA,GAA2B;AAAA,UAAtBb,KAAsB,QAAtBA,KAAsB;;AAChE,UAAMc,eAAe,GAAG,SAAlBA,eAAkB,GAAM;AAC5B,YAAI,CAAC7C,+BAAD,IAAoCC,OAAxC,EAAiD;AAI/CM,UAAAA,SAAS,CAAC,CAACN,OAAD,CAAD,CAAT;AACAK,UAAAA,QAAQ,CAAC;AAAE4B,YAAAA,SAAS,EAAEjC,OAAO,CAACkC,EAArB;AAAyBS,YAAAA,GAAG,EAAHA;AAAzB,WAAD,CAAR;AACApC,UAAAA,UAAU,CAAC,SAAD,CAAV;AACD,SAPD,MAOO,IAAIR,+BAAJ,EAAqC;AAC1CM,UAAAA,QAAQ,CAAC;AAAE4B,YAAAA,SAAS,EAAEjC,OAAF,oBAAEA,OAAO,CAAEkC,EAAtB;AAA0BS,YAAAA,GAAG,EAAHA;AAA1B,WAAD,CAAR;AACApC,UAAAA,UAAU,CAAC,SAAD,CAAV;AACD;AACF,OAZD;;AAcA,UAAMsC,cAAc,GAAG,SAAjBA,cAAiB,GAAM;AAC3B,YAAIH,IAAI,KAAK,OAAT,IAAoB,CAAC,sCAAzB,EAAoD;AAGlD,4CAAcC,GAAd;AACD,SAJD,MAIO;AACLC,UAAAA,eAAe;AAChB;AACF,OARD;;AAUA,UAAME,YAAY,GAAG,8DAA4B;AAC/CnD,QAAAA,SAAS,EAATA,SAD+C;AAE/C2C,QAAAA,QAAQ,EAARA,QAF+C;AAG/C1C,QAAAA,WAAW,EAAXA,WAH+C;AAI/CC,QAAAA,gBAAgB,EAAhBA,gBAJ+C;AAK/C8B,QAAAA,MAAM,EAANA,MAL+C;AAM/CC,QAAAA,kBAAkB,EAAlBA,kBAN+C;AAO/CG,QAAAA,WAAW,EAAXA,WAP+C;AAQ/CI,QAAAA,YAAY,EAAZA,YAR+C;AAS/CI,QAAAA,SAAS,EAATA,SAT+C;AAU/CC,QAAAA,QAAQ,EAARA,QAV+C;AAW/ChB,QAAAA,UAAU,EAAVA,UAX+C;AAY/ChB,QAAAA,UAAU,EAAVA,UAZ+C;AAa/CsB,QAAAA,KAAK,EAALA;AAb+C,OAA5B,CAArB;AAgBA,aACE,gCAAC,6BAAD;AACE,QAAA,aAAa,EAAE,GADjB;AAEE,QAAA,QAAQ,EAAE1B,YAFZ;AAGE,QAAA,GAAG,oBAAkB6B,SAAlB,SAA+BK,QAA/B,SAA2CE,QAA3C,SAAuDf,eAAe,CAACC,MAH5E;AAIE,QAAA,WAAW,EAAE,qBAACqB,KAAD,EAAW;AACtB,cAAI9C,YAAJ,EAAiB;AACfA,YAAAA,YAAW,CAAC;AACV+C,cAAAA,OAAO,EAAE,SADC;AAEVD,cAAAA,KAAK,EAALA;AAFU,aAAD,CAAX;AAID;AACF,SAXH;AAYE,QAAA,OAAO,EAAE,iBAACA,KAAD,EAAW;AAClB,cAAI7C,QAAJ,EAAa;AACXA,YAAAA,QAAO,CAAC;AACN+C,cAAAA,cAAc,EAAEJ,cADV;AAENG,cAAAA,OAAO,EAAE,SAFH;AAGND,cAAAA,KAAK,EAALA;AAHM,aAAD,CAAP;AAKD;AACF,SApBH;AAqBE,QAAA,SAAS,EAAE,mBAACA,KAAD,EAAW;AACpB,cAAI5C,UAAJ,EAAe;AACbA,YAAAA,UAAS,CAAC;AACR8C,cAAAA,cAAc,EAAEJ,cADR;AAERG,cAAAA,OAAO,EAAE,SAFD;AAGRD,cAAAA,KAAK,EAALA;AAHQ,aAAD,CAAT;AAKD;AACF,SA7BH;AA8BE,QAAA,KAAK,EAAE,CACL3E,MAAM,CAACU,cADF,EAEL;AACE6C,UAAAA,MAAM,EAANA,MADF;AAEEG,UAAAA,KAAK,EAALA;AAFF,SAFK,EAMLhD,cANK,CA9BT;AAsCE,QAAA,MAAM,gBACJ8C,kBAAkB,GAAG,KAAH,GAAW,QADzB,UAEFU,QAFE,cAEeE;AAxCvB,SAyCM9C,wBAzCN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UA2CGgD,IAAI,KAAK,OAAT,GACC,gCAAC,cAAD;AACE,QAAA,KAAK,EAAE,CACLI,YADK,EAEL3B,KAFK,EAGL;AACEQ,UAAAA,MAAM,EAAEA,MAAM,GAAG,CADnB;AAEEG,UAAAA,KAAK,EAAEA,KAAK,GAAG;AAFjB,SAHK,CADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADD,GAYC,gCAAC,oBAAD;AACE,QAAA,UAAU,EAAEW,UADd;AAEE,QAAA,KAAK,EAAE,CACLK,YADK,EAEL3B,KAFK,EAGL;AACEQ,UAAAA,MAAM,EAAEA,MAAM,GAAG,CADnB;AAEEG,UAAAA,KAAK,EAAEA,KAAK,GAAG;AAFjB,SAHK,CAFT;AAUE,QAAA,GAAG,EAAEa,GAVP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAvDJ,EAoEGL,QAAQ,KAAKH,YAAY,GAAG,CAA5B,IACDK,QAAQ,KAAKD,SAAS,GAAG,CADxB,IAEDd,eAAe,CAACC,MAAhB,GAAyB,CAFxB,GAGC,gCAAC,iBAAD;AACE,QAAA,KAAK,EAAE,CACLrD,wBAAW6E,kBADN,EAEL9E,MAAM,CAACc,mBAFF,EAGL;AAAEiE,UAAAA,eAAe,EAAEvC;AAAnB,SAHK,EAIL1B,mBAJK,CADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAQE,gCAAC,iBAAD;AAAM,QAAA,KAAK,EAAE,CAACd,MAAM,CAACiB,cAAR,EAAwBA,cAAxB,CAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBACOoC,eAAe,CAACC,MAAhB,GAAyB,CADhC,EARF,CAHD,GAeG,IAnFN,CADF;AAuFD,KAhIA,CAVH,CADF;AA8ID,GAhJA,CAdH,CADF;AAkKD,CAzOD;;AA2OA,IAAM0B,QAAQ,GAAG,SAAXA,QAAW,CACflF,SADe,EAEfC,SAFe,EAGZ;AACH,MACekF,eADf,GAMInF,SANJ,CACE0B,WADF;AAAA,MAEoB0D,oBAFpB,GAMIpF,SANJ,CAEE2B,gBAFF;AAAA,MAGU0D,UAHV,GAMIrF,SANJ,CAGE4B,MAHF;AAAA,MAIW0D,WAJX,GAMItF,SANJ,CAIE8B,OAJF;AAAA,MAKUyD,UALV,GAMIvF,SANJ,CAKEuC,MALF;AAOA,MACeiD,eADf,GAMIvF,SANJ,CACEyB,WADF;AAAA,MAEoB+D,oBAFpB,GAMIxF,SANJ,CAEE0B,gBAFF;AAAA,MAGU+D,UAHV,GAMIzF,SANJ,CAGE2B,MAHF;AAAA,MAIW+D,WAJX,GAMI1F,SANJ,CAIE6B,OAJF;AAAA,MAKU8D,UALV,GAMI3F,SANJ,CAKEsC,MALF;AAQA,MAAMsD,YAAY,GAAG,CAAAP,WAAW,QAAX,YAAAA,WAAW,CAAEtB,EAAb,OAAoB2B,WAApB,oBAAoBA,WAAW,CAAE3B,EAAjC,CAArB;AACA,MAAI,CAAC6B,YAAL,EAAmB,OAAO,KAAP;AAEnB,MAAMC,gBAAgB,GACpBX,eAAe,CAAC3B,MAAhB,KAA2BgC,eAAe,CAAChC,MAA3C,IAAqD2B,eAAe,CAAC,CAAD,CAAf,KAAuBK,eAAe,CAAC,CAAD,CAD7F;AAEA,MAAI,CAACM,gBAAL,EAAuB,OAAO,KAAP;AAEvB,MAAMC,qBAAqB,GAAGX,oBAAoB,KAAKK,oBAAvD;AACA,MAAI,CAACM,qBAAL,EAA4B,OAAO,KAAP;AAE5B,MAAMC,WAAW,GACfX,UAAU,CAAC7B,MAAX,KAAsBkC,UAAU,CAAClC,MAAjC,IACA6B,UAAU,CAACY,KAAX,CACE,UAAChD,KAAD,EAAQiD,KAAR;AAAA,WACE,gCAAoBjD,KAAK,CAACkD,SAA1B,MAAyC,gCAAoBT,UAAU,CAACQ,KAAD,CAAV,CAAkBC,SAAtC,CAAzC,IACA,gCAAoBlD,KAAK,CAACmD,SAA1B,MAAyC,gCAAoBV,UAAU,CAACQ,KAAD,CAAV,CAAkBE,SAAtC,CAF3C;AAAA,GADF,CAFF;AAOA,MAAI,CAACJ,WAAL,EAAkB,OAAO,KAAP;AAElB,MAAMK,WAAW,GACfd,UAAU,CAAC/B,MAAX,KAAsBoC,UAAU,CAACpC,MAAjC,IACA+B,UAAU,CAACU,KAAX,CACE,UAAChD,KAAD,EAAQiD,KAAR;AAAA,WACE,gCAAoBjD,KAAK,CAACkD,SAA1B,MAAyC,gCAAoBP,UAAU,CAACM,KAAD,CAAV,CAAkBC,SAAtC,CAAzC,IACA,gCAAoBlD,KAAK,CAACmD,SAA1B,MAAyC,gCAAoBR,UAAU,CAACM,KAAD,CAAV,CAAkBE,SAAtC,CAF3C;AAAA,GADF,CAFF;AAOA,MAAI,CAACC,WAAL,EAAkB,OAAO,KAAP;AAElB,SAAO,IAAP;AACD,CAhDD;;AAkDA,IAAMC,eAAe,GAAGxG,kBAAMC,IAAN,CAAWwB,kBAAX,EAA+B2D,QAA/B,CAAxB;;AASO,IAAMqB,OAAO,GAAG,SAAVA,OAAU,CAGrB7G,KAHqB,EAIlB;AACH,MAC4B8G,4BAD5B,GAeI9G,KAfJ,CACE8B,wBADF;AAAA,MAEaiF,aAFb,GAeI/G,KAfJ,CAEE+B,SAFF;AAAA,MAGeiF,eAHf,GAeIhH,KAfJ,CAGEgC,WAHF;AAAA,MAIEC,gBAJF,GAeIjC,KAfJ,CAIEiC,gBAJF;AAAA,MAKUgF,UALV,GAeIjH,KAfJ,CAKEkC,MALF;AAAA,MAMegF,eANf,GAeIlH,KAfJ,CAMEqC,WANF;AAAA,MAOW8E,WAPX,GAeInH,KAfJ,CAOEsC,OAPF;AAAA,MAQa8E,aARb,GAeIpH,KAfJ,CAQEuC,SARF;AAAA,MASgB8E,gBAThB,GAeIrH,KAfJ,CASEwC,YATF;AAAA,MAUY8E,YAVZ,GAeItH,KAfJ,CAUEyC,QAVF;AAAA,MAWc8E,cAXd,GAeIvH,KAfJ,CAWE2C,UAXF;AAAA,MAYc6E,cAZd,GAeIxH,KAfJ,CAYE4C,UAZF;AAAA,MAaU6E,UAbV,GAeIzH,KAfJ,CAaE6C,MAbF;AAAA,MAckB6E,kBAdlB,GAeI1H,KAfJ,CAcE8C,cAdF;;AAiBA,8BAAiD,kDAAjD;AAAA,MAAkB6E,eAAlB,yBAAQlF,QAAR;AAAA,MAAmCC,SAAnC,yBAAmCA,SAAnC;;AACA,2BAWI,wCAXJ;AAAA,MACakF,gBADb,sBACE7F,SADF;AAAA,MAEe8F,kBAFf,sBAEE7F,WAFF;AAAA,MAGU8F,aAHV,sBAGE5F,MAHF;AAAA,MAIEE,OAJF,sBAIEA,OAJF;AAAA,MAKe2F,kBALf,sBAKE1F,WALF;AAAA,MAMW2F,cANX,sBAME1F,OANF;AAAA,MAOa2F,gBAPb,sBAOE1F,SAPF;AAAA,MAQgB2F,mBARhB,sBAQE1F,YARF;AAAA,MASc2F,iBATd,sBASEvF,UATF;AAAA,MAUUwF,aAVV,sBAUEvF,MAVF;;AAYA,4BAII,0CAJJ;AAAA,MAC4BwF,+BAD5B,uBACEvG,wBADF;AAAA,MAEEK,+BAFF,uBAEEA,+BAFF;AAAA,MAGkBmG,sBAHlB,uBAGExF,cAHF;;AAKA,2BAA0C,wCAA1C;AAAA,MAAoByF,iBAApB,sBAAQ5F,UAAR;;AAEA,MAAMT,MAAM,GAAG+E,UAAU,IAAIa,aAA7B;AACA,MAAMjF,MAAM,GAAG4E,UAAU,IAAIW,aAA7B;AAEA,MAAI,CAAClG,MAAM,CAAC4B,MAAR,IAAkB,CAACjB,MAAM,CAACiB,MAA9B,EAAsC,OAAO,IAAP;AAEtC,MAAMhC,wBAAwB,GAAGgF,4BAA4B,IAAIuB,+BAAjE;AACA,MAAMtG,SAAS,GAAGgF,aAAa,IAAIa,gBAAnC;AACA,MAAM5F,WAAW,GAAGgF,eAAe,IAAIa,kBAAvC;AACA,MAAMxF,WAAW,GAAG6E,eAAe,IAAIa,kBAAvC;AACA,MAAMxF,SAAS,GAAG6E,aAAa,IAAIa,gBAAnC;AACA,MAAM3F,OAAO,GAAG6E,WAAW,IAAIa,cAA/B;AACA,MAAMxF,YAAY,GAChB,OAAO6E,gBAAP,KAA4B,SAA5B,GAAwCA,gBAAxC,GAA2Da,mBAD7D;AAEA,MAAMzF,QAAQ,GAAG6E,YAAY,IAAIK,eAAjC;AACA,MAAMhF,UAAU,GAAG4E,cAAc,IAAIgB,iBAArC;AACA,MAAM3F,UAAU,GAAG4E,cAAc,IAAIW,iBAArC;AACA,MAAMrF,cAAc,GAAG4E,kBAAkB,IAAIY,sBAA7C;AAEA,SACE,gCAAC,eAAD;AAEIxG,IAAAA,wBAAwB,EAAxBA,wBAFJ;AAGIC,IAAAA,SAAS,EAATA,SAHJ;AAIIyG,IAAAA,SAAS,EAAEpG,OAAF,oBAAEA,OAAO,CAAEqG,GAJxB;AAKIzG,IAAAA,WAAW,EAAXA,WALJ;AAMIC,IAAAA,gBAAgB,EAAEA,gBAAgB,IAAI,CAAC,EAACG,OAAD,YAACA,OAAO,CAAEsG,WAAV,CAN3C;AAOIxG,IAAAA,MAAM,EAANA,MAPJ;AAQIC,IAAAA,+BAA+B,EAA/BA,+BARJ;AASIC,IAAAA,OAAO,EAAPA,OATJ;AAUIC,IAAAA,WAAW,EAAXA,WAVJ;AAWIC,IAAAA,OAAO,EAAPA,OAXJ;AAYIC,IAAAA,SAAS,EAATA,SAZJ;AAaIC,IAAAA,YAAY,EAAZA,YAbJ;AAcIC,IAAAA,QAAQ,EAARA,QAdJ;AAeIC,IAAAA,SAAS,EAATA,SAfJ;AAgBIC,IAAAA,UAAU,EAAVA,UAhBJ;AAiBIC,IAAAA,UAAU,EAAVA,UAjBJ;AAkBIC,IAAAA,MAAM,EAANA,MAlBJ;AAmBIC,IAAAA,cAAc,EAAdA,cAnBJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF;AAwBD,CApFM;;;AAsFP+D,OAAO,CAAC8B,WAAR,GAAsB,iCAAtB","sourcesContent":["import React, { useMemo } from 'react';\nimport { Image, ImageProps, StyleSheet, Text, TouchableOpacity, View } from 'react-native';\n\nimport { buildGallery } from './utils/buildGallery/buildGallery';\n\nimport { getGalleryImageBorderRadius } from './utils/getGalleryImageBorderRadius';\n\nimport { openUrlSafely } from './utils/openUrlSafely';\n\nimport type { MessageType } from '../../components/MessageList/hooks/useMessageList';\nimport {\n  ImageGalleryContextValue,\n  useImageGalleryContext,\n} from '../../contexts/imageGalleryContext/ImageGalleryContext';\nimport {\n  MessageContextValue,\n  useMessageContext,\n} from '../../contexts/messageContext/MessageContext';\nimport {\n  MessagesContextValue,\n  useMessagesContext,\n} from '../../contexts/messagesContext/MessagesContext';\nimport {\n  OverlayContextValue,\n  useOverlayContext,\n} from '../../contexts/overlayContext/OverlayContext';\nimport { useTheme } from '../../contexts/themeContext/ThemeContext';\nimport { isVideoPackageAvailable } from '../../native';\nimport type { DefaultStreamChatGenerics } from '../../types/types';\nimport { getUrlWithoutParams, makeImageCompatibleUrl } from '../../utils/utils';\n\nconst GalleryImage: React.FC<\n  Omit<ImageProps, 'height' | 'source'> & {\n    uri: string;\n  }\n> = (props) => {\n  const { uri, ...rest } = props;\n\n  return (\n    <Image\n      {...rest}\n      source={{\n        uri: makeImageCompatibleUrl(uri),\n      }}\n      testID='image-attachment-single'\n    />\n  );\n};\n\nconst MemoizedGalleryImage = React.memo(\n  GalleryImage,\n  (prevProps, nextProps) =>\n    getUrlWithoutParams(prevProps.uri) === getUrlWithoutParams(nextProps.uri),\n) as typeof GalleryImage;\n\nconst styles = StyleSheet.create({\n  flex: { flex: 1 },\n  galleryContainer: {\n    borderTopLeftRadius: 13,\n    borderTopRightRadius: 13,\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    overflow: 'hidden',\n  },\n  imageContainer: { display: 'flex', flexDirection: 'row', justifyContent: 'center', padding: 1 },\n  moreImagesContainer: {\n    alignItems: 'center',\n    justifyContent: 'center',\n    margin: 1,\n  },\n  moreImagesText: { color: '#FFFFFF', fontSize: 26, fontWeight: '700' },\n});\n\nexport type GalleryPropsWithContext<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Pick<ImageGalleryContextValue<StreamChatGenerics>, 'setImage' | 'setImages'> &\n  Pick<\n    MessageContextValue<StreamChatGenerics>,\n    | 'alignment'\n    | 'groupStyles'\n    | 'images'\n    | 'videos'\n    | 'onLongPress'\n    | 'onPress'\n    | 'onPressIn'\n    | 'preventPress'\n    | 'threadList'\n  > &\n  Pick<\n    MessagesContextValue<StreamChatGenerics>,\n    'additionalTouchableProps' | 'legacyImageViewerSwipeBehaviour' | 'VideoThumbnail'\n  > &\n  Pick<OverlayContextValue, 'setOverlay'> & {\n    channelId: string | undefined;\n    hasThreadReplies?: boolean;\n    /**\n     * `message` prop has been introduced here as part of `legacyImageViewerSwipeBehaviour` prop.\n     * https://github.com/GetStream/stream-chat-react-native/commit/d5eac6193047916f140efe8e396a671675c9a63f\n     * messageId and messageText may seem redundant now, but to avoid breaking change as part\n     * of minor release, we are keeping those props.\n     *\n     * Also `message` type should ideally be imported from MessageContextValue and not be explicitely mentioned\n     * here, but due to some circular dependencies within the SDK, it causes \"exccesive deep nesting\" issue with\n     * typescript within Channel component. We should take it as a mini-project and resolve all these circular imports.\n     *\n     * TODO: Fix circular dependencies of imports\n     */\n    message?: MessageType<StreamChatGenerics>;\n  };\n\nconst GalleryWithContext = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: GalleryPropsWithContext<StreamChatGenerics>,\n) => {\n  const {\n    additionalTouchableProps,\n    alignment,\n    groupStyles,\n    hasThreadReplies,\n    images,\n    legacyImageViewerSwipeBehaviour,\n    message,\n    onLongPress,\n    onPress,\n    onPressIn,\n    preventPress,\n    setImage,\n    setImages,\n    setOverlay,\n    threadList,\n    videos,\n    VideoThumbnail,\n  } = props;\n\n  const {\n    theme: {\n      colors: { overlay },\n      messageSimple: {\n        gallery: {\n          galleryContainer,\n          galleryItemColumn,\n          gridHeight,\n          gridWidth,\n          image,\n          imageContainer,\n          maxHeight,\n          maxWidth,\n          minHeight,\n          minWidth,\n          moreImagesContainer,\n          moreImagesText,\n        },\n      },\n    },\n  } = useTheme();\n\n  const sizeConfig = {\n    gridHeight,\n    gridWidth,\n    maxHeight,\n    maxWidth,\n    minHeight,\n    minWidth,\n  };\n\n  const imagesAndVideos = [...(images || []), ...(videos || [])];\n  const { height, invertedDirections, thumbnailGrid, width } = useMemo(\n    () =>\n      buildGallery({\n        images: imagesAndVideos,\n        sizeConfig,\n      }),\n    [imagesAndVideos.length],\n  );\n\n  if (!imagesAndVideos?.length) return null;\n  const messageText = message?.text;\n  const messageId = message?.id;\n  const numOfColumns = thumbnailGrid.length;\n\n  return (\n    <View\n      style={[\n        styles.galleryContainer,\n        {\n          height,\n          width,\n        },\n        galleryContainer,\n        {\n          flexDirection: invertedDirections ? 'column' : 'row',\n        },\n      ]}\n      testID='gallery-container'\n    >\n      {thumbnailGrid.map((rows, colIndex) => {\n        const numOfRows = rows.length;\n        return (\n          <View\n            key={`gallery-${invertedDirections ? 'row' : 'column'}-${colIndex}`}\n            style={[\n              {\n                flexDirection: invertedDirections ? 'row' : 'column',\n              },\n              galleryItemColumn,\n            ]}\n            testID={`gallery-${invertedDirections ? 'row' : 'column'}-${colIndex}`}\n          >\n            {rows.map(({ height, resizeMode, type, url, width }, rowIndex) => {\n              const openImageViewer = () => {\n                if (!legacyImageViewerSwipeBehaviour && message) {\n                  // Added if-else to keep the logic readable, instead of DRY.\n                  // if - legacyImageViewerSwipeBehaviour is disabled\n                  // else - legacyImageViewerSwipeBehaviour is enabled\n                  setImages([message]);\n                  setImage({ messageId: message.id, url });\n                  setOverlay('gallery');\n                } else if (legacyImageViewerSwipeBehaviour) {\n                  setImage({ messageId: message?.id, url });\n                  setOverlay('gallery');\n                }\n              };\n\n              const defaultOnPress = () => {\n                if (type === 'video' && !isVideoPackageAvailable()) {\n                  // This condition is kinda unreachable, since we render videos as file attachment if the video\n                  // library is not installed. But doesn't hurt to have extra safeguard, in case of some customizations.\n                  openUrlSafely(url);\n                } else {\n                  openImageViewer();\n                }\n              };\n\n              const borderRadius = getGalleryImageBorderRadius({\n                alignment,\n                colIndex,\n                groupStyles,\n                hasThreadReplies,\n                height,\n                invertedDirections,\n                messageText,\n                numOfColumns,\n                numOfRows,\n                rowIndex,\n                sizeConfig,\n                threadList,\n                width,\n              });\n\n              return (\n                <TouchableOpacity\n                  activeOpacity={0.8}\n                  disabled={preventPress}\n                  key={`gallery-item-${messageId}/${colIndex}/${rowIndex}/${imagesAndVideos.length}`}\n                  onLongPress={(event) => {\n                    if (onLongPress) {\n                      onLongPress({\n                        emitter: 'gallery',\n                        event,\n                      });\n                    }\n                  }}\n                  onPress={(event) => {\n                    if (onPress) {\n                      onPress({\n                        defaultHandler: defaultOnPress,\n                        emitter: 'gallery',\n                        event,\n                      });\n                    }\n                  }}\n                  onPressIn={(event) => {\n                    if (onPressIn) {\n                      onPressIn({\n                        defaultHandler: defaultOnPress,\n                        emitter: 'gallery',\n                        event,\n                      });\n                    }\n                  }}\n                  style={[\n                    styles.imageContainer,\n                    {\n                      height,\n                      width,\n                    },\n                    imageContainer,\n                  ]}\n                  testID={`gallery-${\n                    invertedDirections ? 'row' : 'column'\n                  }-${colIndex}-item-${rowIndex}`}\n                  {...additionalTouchableProps}\n                >\n                  {type === 'video' ? (\n                    <VideoThumbnail\n                      style={[\n                        borderRadius,\n                        image,\n                        {\n                          height: height - 1,\n                          width: width - 1,\n                        },\n                      ]}\n                    />\n                  ) : (\n                    <MemoizedGalleryImage\n                      resizeMode={resizeMode}\n                      style={[\n                        borderRadius,\n                        image,\n                        {\n                          height: height - 1,\n                          width: width - 1,\n                        },\n                      ]}\n                      uri={url}\n                    />\n                  )}\n                  {colIndex === numOfColumns - 1 &&\n                  rowIndex === numOfRows - 1 &&\n                  imagesAndVideos.length > 4 ? (\n                    <View\n                      style={[\n                        StyleSheet.absoluteFillObject,\n                        styles.moreImagesContainer,\n                        { backgroundColor: overlay },\n                        moreImagesContainer,\n                      ]}\n                    >\n                      <Text style={[styles.moreImagesText, moreImagesText]}>\n                        {`+${imagesAndVideos.length - 4}`}\n                      </Text>\n                    </View>\n                  ) : null}\n                </TouchableOpacity>\n              );\n            })}\n          </View>\n        );\n      })}\n    </View>\n  );\n};\n\nconst areEqual = <StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics>(\n  prevProps: GalleryPropsWithContext<StreamChatGenerics>,\n  nextProps: GalleryPropsWithContext<StreamChatGenerics>,\n) => {\n  const {\n    groupStyles: prevGroupStyles,\n    hasThreadReplies: prevHasThreadReplies,\n    images: prevImages,\n    message: prevMessage,\n    videos: prevVideos,\n  } = prevProps;\n  const {\n    groupStyles: nextGroupStyles,\n    hasThreadReplies: nextHasThreadReplies,\n    images: nextImages,\n    message: nextMessage,\n    videos: nextVideos,\n  } = nextProps;\n\n  const messageEqual = prevMessage?.id === nextMessage?.id;\n  if (!messageEqual) return false;\n\n  const groupStylesEqual =\n    prevGroupStyles.length === nextGroupStyles.length && prevGroupStyles[0] === nextGroupStyles[0];\n  if (!groupStylesEqual) return false;\n\n  const hasThreadRepliesEqual = prevHasThreadReplies === nextHasThreadReplies;\n  if (!hasThreadRepliesEqual) return false;\n\n  const imagesEqual =\n    prevImages.length === nextImages.length &&\n    prevImages.every(\n      (image, index) =>\n        getUrlWithoutParams(image.image_url) === getUrlWithoutParams(nextImages[index].image_url) &&\n        getUrlWithoutParams(image.thumb_url) === getUrlWithoutParams(nextImages[index].thumb_url),\n    );\n  if (!imagesEqual) return false;\n\n  const videosEqual =\n    prevVideos.length === nextVideos.length &&\n    prevVideos.every(\n      (image, index) =>\n        getUrlWithoutParams(image.image_url) === getUrlWithoutParams(nextVideos[index].image_url) &&\n        getUrlWithoutParams(image.thumb_url) === getUrlWithoutParams(nextVideos[index].thumb_url),\n    );\n  if (!videosEqual) return false;\n\n  return true;\n};\n\nconst MemoizedGallery = React.memo(GalleryWithContext, areEqual) as typeof GalleryWithContext;\n\nexport type GalleryProps<\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n> = Partial<GalleryPropsWithContext<StreamChatGenerics>>;\n\n/**\n * UI component for card in attachments.\n */\nexport const Gallery = <\n  StreamChatGenerics extends DefaultStreamChatGenerics = DefaultStreamChatGenerics,\n>(\n  props: GalleryProps<StreamChatGenerics>,\n) => {\n  const {\n    additionalTouchableProps: propAdditionalTouchableProps,\n    alignment: propAlignment,\n    groupStyles: propGroupStyles,\n    hasThreadReplies,\n    images: propImages,\n    onLongPress: propOnLongPress,\n    onPress: propOnPress,\n    onPressIn: propOnPressIn,\n    preventPress: propPreventPress,\n    setImage: propSetImage,\n    setOverlay: propSetOverlay,\n    threadList: propThreadList,\n    videos: propVideos,\n    VideoThumbnail: PropVideoThumbnail,\n  } = props;\n\n  const { setImage: contextSetImage, setImages } = useImageGalleryContext<StreamChatGenerics>();\n  const {\n    alignment: contextAlignment,\n    groupStyles: contextGroupStyles,\n    images: contextImages,\n    message,\n    onLongPress: contextOnLongPress,\n    onPress: contextOnPress,\n    onPressIn: contextOnPressIn,\n    preventPress: contextPreventPress,\n    threadList: contextThreadList,\n    videos: contextVideos,\n  } = useMessageContext<StreamChatGenerics>();\n  const {\n    additionalTouchableProps: contextAdditionalTouchableProps,\n    legacyImageViewerSwipeBehaviour,\n    VideoThumbnail: ContextVideoThumnbnail,\n  } = useMessagesContext<StreamChatGenerics>();\n  const { setOverlay: contextSetOverlay } = useOverlayContext();\n\n  const images = propImages || contextImages;\n  const videos = propVideos || contextVideos;\n\n  if (!images.length && !videos.length) return null;\n\n  const additionalTouchableProps = propAdditionalTouchableProps || contextAdditionalTouchableProps;\n  const alignment = propAlignment || contextAlignment;\n  const groupStyles = propGroupStyles || contextGroupStyles;\n  const onLongPress = propOnLongPress || contextOnLongPress;\n  const onPressIn = propOnPressIn || contextOnPressIn;\n  const onPress = propOnPress || contextOnPress;\n  const preventPress =\n    typeof propPreventPress === 'boolean' ? propPreventPress : contextPreventPress;\n  const setImage = propSetImage || contextSetImage;\n  const setOverlay = propSetOverlay || contextSetOverlay;\n  const threadList = propThreadList || contextThreadList;\n  const VideoThumbnail = PropVideoThumbnail || ContextVideoThumnbnail;\n\n  return (\n    <MemoizedGallery\n      {...{\n        additionalTouchableProps,\n        alignment,\n        channelId: message?.cid,\n        groupStyles,\n        hasThreadReplies: hasThreadReplies || !!message?.reply_count,\n        images,\n        legacyImageViewerSwipeBehaviour,\n        message,\n        onLongPress,\n        onPress,\n        onPressIn,\n        preventPress,\n        setImage,\n        setImages,\n        setOverlay,\n        threadList,\n        videos,\n        VideoThumbnail,\n      }}\n    />\n  );\n};\n\nGallery.displayName = 'Gallery{messageSimple{gallery}}';\n"]}